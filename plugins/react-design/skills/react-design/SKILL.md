---
name: react-design
description: このスキルはReactのコードレビューや設計の相談で使用する。Reactを用いたコードのレビュー時や「Reactコンポーネントの設計」「Reactのベストプラクティス」「Stateの管理」「Hooksへのロジックの分離」「コンポーネント最適化」「Reactアーキテクチャ」「Reactの全般的な設計」などの質問や相談の際に使用する。
---

# React設計ガイド

React公式ドキュメントに基づいた設計知識とベストプラクティスを提供するスキル。コンポーネント設計、State管理、パフォーマンス最適化など、Reactアプリケーション開発で必要な知識をカバーする。

## スキルの目的

このスキルは、React開発における以下の領域で設計支援を提供する:

1. **コンポーネント設計**: UIを再利用可能なパーツに分解し、適切な構造を設計する
2. **State管理**: アプリケーション状態を効率的に管理し、データフローを最適化する
3. **パフォーマンス最適化**: 不要な再レンダーを避け、アプリケーションを高速化する
4. **ベストプラクティス**: React公式が推奨する設計パターンと開発手法を適用する

## 使用タイミング

以下のような状況で、このスキルを活用する:

- コンポーネントの構造や分割方法について相談したい
- Stateをどこに配置し、どう管理すべきか判断に迷っている
- 条件付きレンダリングやリスト表示の実装方法を確認したい
- HooksやContext、Reducerの使い分けを理解したい
- パフォーマンス問題を特定し、最適化したい
- React公式のベストプラクティスに沿った実装を確認したい

## 主要トピックの概要

### 1. UIの記述

Reactアプリケーションの基盤となるUI構築の原則:

**コンポーネント設計**
- コンポーネントは「マークアップを添えることができるJavaScript関数」
- UIを小さく再利用可能な独立したパーツに分解する
- ファイル分割で管理性を向上させる

**JSXマークアップ**
- HTMLに似ているが、より厳密な構文規則
- 属性名の違いに注意（`className`、`htmlFor`など）
- 自己終結タグは必須

**Propsによるデータ受け渡し**
- 親から子へ情報を渡すメカニズム
- あらゆるJavaScript値を渡せる（オブジェクト、配列、関数、JSXを含む）
- propsは読み取り専用

**条件付きレンダリング**
- `if`文、`&&`演算子、三項演算子を活用
- 状況に応じた表示切り替えを実現

**リストレンダリング**
- `map()`と`filter()`で配列を処理
- 各要素に一意の`key`を指定してReactがアイテムを追跡できるようにする

**コンポーネントの純粋性**
- 純関数として設計: 同じ入力で常に同じ出力
- 外部の変数やオブジェクトを変更しない
- 予測不可能なバグを回避

詳細は `references/ui-description.md` を参照。

### 2. インタラクティビティの追加

ユーザー操作に応答する動的なUIを構築:

**イベントハンドリング**
- JSXにイベントハンドラを追加（`onClick`など）
- カスタムコンポーネントで任意のイベント名を定義可能

**State（状態）管理**
- `useState`で時間とともに変化するデータを管理
- State更新時に自動的に再レンダーがトリガされる
- 複数のState変数を必要に応じて宣言

**レンダーとコミット**
- UIの更新は3段階: トリガ → レンダー → コミット
- Reactがレストランのウェイター、コンポーネントが料理人のメタファー

**Stateのスナップショット**
- State更新は即座に反映されず、再レンダーをリクエストする
- イベントハンドラ内では現在のStateの「スナップショット」を参照

**State更新のキューイング**
- 複数のState更新を連続実行する場合は更新用関数を使用
- `setScore(s => s + 1)`でキューに積み重ねる

**オブジェクトと配列の更新**
- State内のオブジェクトや配列を直接変更しない
- スプレッド構文で新しいオブジェクト/配列を作成
- Immerライブラリで定型コードを削減可能

詳細は `references/interactivity.md` を参照。

### 3. State管理

複雑なアプリケーション状態を効果的に管理:

**State構造の設計**
- 冗長な情報や重複を避ける
- 計算可能な値はStateではなくレンダー時に計算

**コンポーネント間でのState共有**
- 「Stateのリフトアップ」で共通の親に移動
- propsで子コンポーネントに値を渡す

**Stateの保持とリセット**
- Reactはコンポーネントツリーの「一致する」部分を保持
- `key`を変更して強制的にリセット

**Reducerの活用**
- 複雑なState更新ロジックを単一関数に集約
- イベントハンドラが簡潔になる
- アクション型を指定するだけで更新

**Contextの活用**
- props drillingを回避
- 深い階層でも情報を共有
- テーマ、認証情報などグローバルなデータに最適

**ReducerとContextの組み合わせ**
- 複雑な画面のState管理に最適
- ReducerでStateを管理、Contextで配信

詳細は `references/state-management.md` を参照。

### 4. 避難ハッチ（高度なパターン）

React外部システムとの統合や高度な機能:

**Refの使い方**
- 再レンダーをトリガしないコンポーネントの「秘密のポケット」
- タイムアウトID、DOM要素の格納に使用
- `ref.current`でアクセス

**DOM操作**
- フォーカス、スクロール、サイズ測定など必要最小限に
- `ref`属性でDOM要素を参照
- 通常はReactの宣言的アプローチを優先

**Effectの同期**
- 外部システムとコンポーネントを同期
- レンダー後にコードを実行
- クリーンアップ関数で接続解除などを処理

**Effectの最適化**
- レンダー時に計算可能な値はEffectの外で処理
- 外部システムとの同期にのみEffectを使用
- 不要なEffectを削除して可読性向上

**Effectのライフサイクル**
- 同期開始と同期停止の2段階
- リアクティブ値（props/state）の変更で再同期
- 依存配列で細かく制御

**カスタムフック**
- アプリケーション固有のロジックを再利用可能に
- `useState`、`useEffect`などを組み合わせ
- コンポーネント間でロジック共有

詳細は `references/advanced-patterns.md` を参照。

## 設計アプローチ

React設計の相談を受けた際は、以下の順序で検討する:

1. **要件の理解**: ユーザーが実現したい機能や解決したい問題を明確にする
2. **コンポーネント構造の検討**: UIをどのようなコンポーネントに分割すべきか提案する
3. **Stateの配置**: どのコンポーネントがStateを持つべきか、リフトアップが必要か判断する
4. **データフローの設計**: propsとStateのフローを明確にする
5. **最適化の検討**: パフォーマンスやメンテナンス性を考慮した改善案を提示する

## ベストプラクティスの原則

React公式ドキュメントに基づく重要な原則:

- **コンポーネントは純粋に保つ**: 同じ入力で常に同じ出力
- **State構造をシンプルに**: 冗長性と重複を避ける
- **適切な抽象化**: 過度な最適化や抽象化を避け、必要になってから実装
- **宣言的に記述**: 命令的なDOM操作よりReactの宣言的アプローチを優先
- **Effectは最小限に**: 外部システムとの同期にのみ使用
- **keyを正しく使う**: リストレンダリングで各アイテムを追跡できるようにする

## 追加リソース

より詳細な情報が必要な場合、以下のリファレンスファイルを参照:

### リファレンスファイル

- **`references/ui-description.md`** - UIの記述に関する詳細（コンポーネント、JSX、Props、条件付きレンダリング、リストレンダリング、純粋性）
- **`references/interactivity.md`** - インタラクティビティに関する詳細（イベント、State、レンダーサイクル、スナップショット、キューイング、オブジェクト/配列更新）
- **`references/state-management.md`** - State管理の詳細（構造設計、共有、保持/リセット、Reducer、Context、組み合わせ）
- **`references/advanced-patterns.md`** - 高度なパターンの詳細（Ref、DOM操作、Effect、最適化、ライフサイクル、カスタムフック）

各リファレンスファイルには、トピックごとの詳細な説明、具体例、ベストプラクティスが含まれている。
